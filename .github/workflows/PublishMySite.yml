name: Publish to GitHub Pages

on:
  push:
    branches:
      - main  # 或者 master，根据你的主分支名

# 1. 自动取消旧构建
concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

permissions:
  contents: write

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 10 # 为了 git-revision-date-localized 需要全量历史，如果太慢可改为 0 以外的数字

      # 2. 启用 Python 缓存
      - uses: actions/setup-python@v5
        with:
          python-version: 3.x
          cache: 'pip' 
      
      # 3. 安装依赖 (如果 requirements.txt 没变，这步会飞快)
      - run: pip install -r requirements.txt

      # 4. 构建并部署
      - run: mkdocs gh-deploy --force